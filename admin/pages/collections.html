<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è—å“ç®¡ç† - å˜‰å­šå ‚åå°ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
</head>
<body>
    <div class="admin-wrapper">
        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="../../images/logo.png" alt="å˜‰å­šå ‚">
                <h2>åå°ç®¡ç†</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="../dashboard.html" class="nav-item">
                    <span>ğŸ“Š</span> <span>æ§åˆ¶å°</span>
                </a>
                <a href="collections.html" class="nav-item active">
                    <span>ğŸ¨</span> <span>è—å“ç®¡ç†</span>
                </a>
                <a href="news.html" class="nav-item">
                    <span>ğŸ“°</span> <span>æ–°é—»ç®¡ç†</span>
                </a>
                <a href="submissions.html" class="nav-item">
                    <span>ğŸ“‹</span> <span>æäº¤è®°å½•</span>
                </a>
                <a href="#" onclick="logout(); return false;" class="nav-item">
                    <span>ğŸšª</span> <span>é€€å‡ºç™»å½•</span>
                </a>
            </nav>
        </aside>

        <!-- ä¸»å†…å®¹ -->
        <main class="main-content">
            <div class="page-header">
                <h1>è—å“ç®¡ç†</h1>
                <button class="btn-sm btn-view" onclick="openModal()">+ æ·»åŠ è—å“</button>
            </div>

            <!-- ç­›é€‰ -->
            <div class="filter-bar">
                <select id="filterCategory" onchange="renderTable()">
                    <option value="">å…¨éƒ¨åˆ†ç±»</option>
                    <option value="art">è‰ºæœ¯å“</option>
                    <option value="antique">å¤è‘£æ–‡ç‰©</option>
                    <option value="jewelry">ç å®å¥¢ä¾ˆå“</option>
                    <option value="coin">æ–‡çŒ®é‚®å¸</option>
                    <option value="nft">æ•°å­—è—å“</option>
                    <option value="misc">æ‚é¡¹</option>
                </select>
                <select id="filterStatus" onchange="renderTable()">
                    <option value="">å…¨éƒ¨çŠ¶æ€</option>
                    <option value="unsold">æœªæ‹å–</option>
                    <option value="sold">å·²æ‹å–</option>
                    <option value="coming">å³å°†æ‹å–</option>
                </select>
                <input type="text" id="searchKeyword" placeholder="æœç´¢è—å“..." oninput="renderTable()">
            </div>

            <!-- è¡¨æ ¼ -->
            <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ç¼–å·</th>
                            <th>åç§°</th>
                            <th>åˆ†ç±»</th>
                            <th>çŠ¶æ€</th>
                            <th>é¦–é¡µæ¨è</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="collectionsTable">
                    </tbody>
                </table>
            </div>

            <!-- åˆ†é¡µ -->
            <div class="pagination" id="pagination">
            </div>
        </main>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘å¼¹çª— -->
    <div class="modal-overlay" id="collectionModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">æ·»åŠ è—å“</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="collectionForm">
                    <input type="hidden" id="collectionId">
                    <div class="form-row">
                        <div class="form-group">
                            <label>è—å“åç§° *</label>
                            <input type="text" id="itemTitle" required>
                        </div>
                        <div class="form-group">
                            <label>å“ç±» *</label>
                            <select id="itemCategory" required>
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="art">è‰ºæœ¯å“</option>
                                <option value="antique">å¤è‘£æ–‡ç‰©</option>
                                <option value="jewelry">ç å®å¥¢ä¾ˆå“</option>
                                <option value="coin">æ–‡çŒ®é‚®å¸</option>
                                <option value="nft">æ•°å­—è—å“</option>
                                <option value="misc">æ‚é¡¹</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>çŠ¶æ€ *</label>
                            <select id="itemStatus" required>
                                <option value="unsold">æœªæ‹å–</option>
                                <option value="sold">å·²æ‹å–</option>
                                <option value="coming">å³å°†æ‹å–</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>é¦–é¡µæ¨è</label>
                            <select id="itemFeatured">
                                <option value="false">å¦</option>
                                <option value="true">æ˜¯</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>å°é¢å›¾ç‰‡URL</label>
                        <input type="text" id="itemCoverImage" placeholder="https://...">
                    </div>
                    <div class="form-group">
                        <label>ç®€ä»‹</label>
                        <textarea id="itemSummary" placeholder="ç®€çŸ­æè¿°..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>è¯¦ç»†æè¿°</label>
                        <textarea id="itemContent" placeholder="è¯¦ç»†æè¿°å†…å®¹..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                        <button type="button" class="btn-save" onclick="saveCollection()">ä¿å­˜</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="../js/auth.js"></script>
    <script>
        let collections = [];
        let currentPage = 1;
        const pageSize = 10;
        
        // å­˜å‚¨é”®å
        const STORAGE_KEY = 'jiafu_collections';
        
        // åˆå§‹åŒ–
        function init() {
            loadCollections();
        }
        
        // åŠ è½½è—å“æ•°æ® - ä¼˜å…ˆä»localStorage
        function loadCollections() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                try {
                    collections = JSON.parse(stored);
                } catch(e) {
                    collections = getDefaultCollections();
                }
            } else {
                collections = getDefaultCollections();
                saveToStorage();
            }
            renderTable();
        }
        
        // é»˜è®¤æ•°æ®
        function getDefaultCollections() {
            return [
                {id:1,title:'æ¸…ä»£ç´«æª€æœ¨é›•ç¦ç¦„å¯¿å±é£',category:'antique',status:'sold',coverImage:'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400',summary:'æ¸…ä»£æ™šæœŸç´«æª€æœ¨é›•',isFeatured:true,sort:1},
                {id:2,title:'æ°‘å›½ç²‰å½©äººç‰©æ•…äº‹ç“¶',category:'antique',status:'coming',coverImage:'https://images.unsplash.com/photo-1565193566173-7a0ee3dbe261?w=400',summary:'æ°‘å›½ç²‰å½©åå“',isFeatured:true,sort:2},
                {id:3,title:'æ˜å¼é»„èŠ±æ¢¨å®˜å¸½æ¤…',category:'antique',status:'sold',coverImage:'https://images.unsplash.com/photo-1506439773649-6e0eb8cfb237?w=400',summary:'æ˜å¼å®¶å…·',isFeatured:false,sort:3},
                {id:4,title:'å®‹ä»£å»ºçª‘å…”æ¯«ç›',category:'antique',status:'sold',coverImage:'https://images.unsplash.com/photo-1544787219-7f47ccb76574?w=400',summary:'å®‹ä»£å»ºçª‘',isFeatured:false,sort:4},
                {id:5,title:'é½ç™½çŸ³ã€Šè™¾è¶£å›¾ã€‹',category:'art',status:'sold',coverImage:'https://images.unsplash.com/photo-1578926288207-a90a5366759d?w=400',summary:'é½ç™½çŸ³ç²¾å“',isFeatured:true,sort:5},
                {id:6,title:'å¼ å¤§åƒã€Šå±±æ°´å››æ¡å±ã€‹',category:'art',status:'unsold',coverImage:'https://images.unsplash.com/photo-1605883705077-8d3d3cebe78c?w=400',summary:'å¼ å¤§åƒå±±æ°´',isFeatured:true,sort:6},
                {id:7,title:'å‚…æŠ±çŸ³ã€Šå±±æ°´é•¿å·ã€‹',category:'art',status:'coming',coverImage:'https://images.unsplash.com/photo-1600636567129-674c947c29b7?w=400',summary:'å‚…æŠ±çŸ³åŠ›ä½œ',isFeatured:false,sort:7},
                {id:8,title:'å¾æ‚²é¸¿ã€Šå¥”é©¬å›¾ã€‹',category:'art',status:'unsold',coverImage:'https://images.unsplash.com/photo-1518998053901-5348d3961a04?w=400',summary:'å¾æ‚²é¸¿ä»£è¡¨ä½œ',isFeatured:false,sort:8},
                {id:9,title:'å¡åœ°äºšé’»çŸ³èƒ¸é’ˆ',category:'jewelry',status:'unsold',coverImage:'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=400',summary:'å¡åœ°äºš',isFeatured:true,sort:9},
                {id:10,title:'ç¿¡ç¿ æ‰‹é•¯ ç»ç’ƒç§',category:'jewelry',status:'coming',coverImage:'https://images.unsplash.com/photo-1602751584552-8ba73aad10e1?w=400',summary:'ç»ç’ƒç§ç¿¡ç¿ ',isFeatured:true,sort:10},
                {id:11,title:'æ¢µå…‹é›…å®é’»çŸ³é¡¹é“¾',category:'jewelry',status:'sold',coverImage:'https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?w=400',summary:'æ¢µå…‹é›…å®',isFeatured:false,sort:11},
                {id:12,title:'çº¢å®çŸ³æˆ’æŒ‡',category:'jewelry',status:'unsold',coverImage:'https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400',summary:'é¸½è¡€çº¢å®çŸ³',isFeatured:false,sort:12},
                {id:13,title:'ç¬¬ä¸€ç‰ˆäººæ°‘å¸å…¨å¥—',category:'coin',status:'sold',coverImage:'https://images.unsplash.com/photo-1621155346337-1d19476ba7d6?w=400',summary:'ç¬¬ä¸€ç‰ˆäººæ°‘å¸',isFeatured:true,sort:13},
                {id:14,title:'æ–‡é©æ—¶æœŸçé‚®ç¥¨',category:'coin',status:'unsold',coverImage:'https://images.unsplash.com/photo-1580196929935-77f7a7a8e389?w=400',summary:'æ–‡é©é‚®ç¥¨',isFeatured:false,sort:14},
                {id:15,title:'è¢å¤§å¤´é“¶å…ƒ',category:'coin',status:'coming',coverImage:'https://images.unsplash.com/photo-1610375461246-83df859d849d?w=400',summary:'è¢å¤§å¤´',isFeatured:false,sort:15},
                {id:16,title:'å¤é’±å¸ä¸€ç»„',category:'coin',status:'unsold',coverImage:'https://images.unsplash.com/photo-1571752726703-5e7d1f6a986d?w=400',summary:'å¤é’±å¸',isFeatured:false,sort:16},
                {id:17,title:'NFTã€Šåˆ›ä¸–ä¹‹å¢ƒã€‹',category:'nft',status:'coming',coverImage:'https://images.unsplash.com/photo-1642104704074-907c0698cbd9?w=400',summary:'æ•°å­—è‰ºæœ¯å“',isFeatured:true,sort:17},
                {id:18,title:'NFTã€Šæ˜Ÿé™…å¹»æƒ³ã€‹',category:'nft',status:'unsold',coverImage:'https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?w=400',summary:'é™é‡ç‰ˆNFT',isFeatured:false,sort:18},
                {id:19,title:'NFTã€Šèµ›åšæœ‹å…‹ã€‹',category:'nft',status:'sold',coverImage:'https://images.unsplash.com/photo-1634152962476-4b8a00e1915c?w=400',summary:'èµ›åšæœ‹å…‹',isFeatured:false,sort:19},
                {id:20,title:'NFTã€ŠæŠ½è±¡è‰ºæœ¯ã€‹',category:'nft',status:'unsold',coverImage:'https://images.unsplash.com/photo-1618005198919-d3d4b5a92ead?w=400',summary:'æŠ½è±¡NFT',isFeatured:false,sort:20},
                {id:21,title:'19ä¸–çºªè¥¿æ´‹åº§é’Ÿ',category:'misc',status:'coming',coverImage:'https://images.unsplash.com/photo-1508057198894-247b23fe5ade?w=400',summary:'è¥¿æ´‹åº§é’Ÿ',isFeatured:false,sort:21},
                {id:22,title:'åŠ³åŠ›å£«æ‰‹è¡¨',category:'misc',status:'sold',coverImage:'https://images.unsplash.com/photo-1523170335258-f5ed11844a49?w=400',summary:'åŠ³åŠ›å£«',isFeatured:true,sort:22},
                {id:23,title:'ç´«ç ‚å£¶ åå®¶æ¬¾',category:'misc',status:'unsold',coverImage:'https://images.unsplash.com/photo-1565193566173-7a0ee3dbe261?w=400',summary:'ç´«ç ‚å£¶',isFeatured:false,sort:23},
                {id:24,title:'æ²‰é¦™æ‰‹ä¸²',category:'misc',status:'coming',coverImage:'https://images.unsplash.com/photo-1611085583191-a3b181a88401?w=400',summary:'æ²‰é¦™',isFeatured:false,sort:24}
            ];
        }
        
        // ä¿å­˜åˆ°localStorage
        function saveToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(collections));
        }
        
        // æ¸²æŸ“è¡¨æ ¼
        function renderTable() {
            const category = document.getElementById('filterCategory').value;
            const status = document.getElementById('filterStatus').value;
            const keyword = document.getElementById('searchKeyword').value;
            
            let filtered = [...collections];
            
            if (category) filtered = filtered.filter(c => c.category === category);
            if (status) filtered = filtered.filter(c => c.status === status);
            if (keyword) filtered = filtered.filter(c => c.title.includes(keyword) || c.summary.includes(keyword));
            
            filtered.sort((a, b) => b.sort - a.sort);
            
            const totalPages = Math.ceil(filtered.length / pageSize);
            const start = (currentPage - 1) * pageSize;
            const paged = filtered.slice(start, start + pageSize);
            
            const tbody = document.getElementById('collectionsTable');
            if (paged.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">æš‚æ— æ•°æ®</td></tr>';
            } else {
                const categoryMap = {art:'è‰ºæœ¯å“',antique:'å¤è‘£æ–‡ç‰©',jewelry:'ç å®å¥¢ä¾ˆå“',coin:'æ–‡çŒ®é‚®å¸',nft:'æ•°å­—è—å“',misc:'æ‚é¡¹'};
                const statusMap = {unsold:'æœªæ‹å–',sold:'å·²æ‹å–',coming:'å³å°†æ‹å–'};
                
                tbody.innerHTML = paged.map(c => `
                    <tr>
                        <td>${c.sort}</td>
                        <td>${c.title}</td>
                        <td>${categoryMap[c.category] || c.category}</td>
                        <td>${statusMap[c.status] || c.status}</td>
                        <td>${c.isFeatured ? 'âœ…' : 'âŒ'}</td>
                        <td>
                            <button class="btn-sm" onclick="editCollection(${c.id})">ç¼–è¾‘</button>
                            <button class="btn-sm btn-danger" onclick="deleteCollection(${c.id})">åˆ é™¤</button>
                        </td>
                    </tr>
                `).join('');
            }
            
            // åˆ†é¡µ
            const pagination = document.getElementById('pagination');
            if (totalPages > 1) {
                let html = '';
                for (let i = 1; i <= totalPages; i++) {
                    html += `<button class="${i === currentPage ? 'active' : ''}" onclick="goPage(${i})">${i}</button>`;
                }
                pagination.innerHTML = html;
            } else {
                pagination.innerHTML = '';
            }
        }
        
        function goPage(page) {
            currentPage = page;
            renderTable();
        }
        
        // æ‰“å¼€å¼¹çª—
        function openModal(id = null) {
            const modal = document.getElementById('collectionModal');
            const title = document.getElementById('modalTitle');
            
            if (id) {
                const item = collections.find(c => c.id === id);
                if (item) {
                    title.textContent = 'ç¼–è¾‘è—å“';
                    document.getElementById('collectionId').value = item.id;
                    document.getElementById('itemTitle').value = item.title;
                    document.getElementById('itemCategory').value = item.category;
                    document.getElementById('itemStatus').value = item.status;
                    document.getElementById('itemFeatured').value = item.isFeatured ? 'true' : 'false';
                    document.getElementById('itemCoverImage').value = item.coverImage || '';
                    document.getElementById('itemSummary').value = item.summary || '';
                    document.getElementById('itemContent').value = item.content || '';
                }
            } else {
                title.textContent = 'æ·»åŠ è—å“';
                document.getElementById('collectionForm').reset();
                document.getElementById('collectionId').value = '';
            }
            
            modal.classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('collectionModal').classList.remove('active');
        }
        
        // ä¿å­˜è—å“
        function saveCollection() {
            const id = document.getElementById('collectionId').value;
            const data = {
                title: document.getElementById('itemTitle').value,
                category: document.getElementById('itemCategory').value,
                status: document.getElementById('itemStatus').value,
                isFeatured: document.getElementById('itemFeatured').value === 'true',
                coverImage: document.getElementById('itemCoverImage').value,
                summary: document.getElementById('itemSummary').value,
                content: document.getElementById('itemContent').value
            };
            
            if (!data.title || !data.category) {
                alert('è¯·å¡«å†™å¿…å¡«é¡¹');
                return;
            }
            
            if (id) {
                const index = collections.findIndex(c => c.id === parseInt(id));
                collections[index] = { ...collections[index], ...data };
            } else {
                const newId = collections.length > 0 ? Math.max(...collections.map(c => c.id)) + 1 : 1;
                collections.push({ id: newId, sort: newId, ...data });
            }
            
            saveToStorage();
            closeModal();
            renderTable();
            alert('ä¿å­˜æˆåŠŸï¼');
        }
        
        // ç¼–è¾‘è—å“
        function editCollection(id) {
            openModal(id);
        }
        
        // åˆ é™¤è—å“
        function deleteCollection(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä»¶è—å“å—ï¼Ÿ')) {
                collections = collections.filter(c => c.id !== id);
                saveToStorage();
                renderTable();
            }
        }
        
        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>
