<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æäº¤è®°å½• - å˜‰å­šå ‚åå°</title>
    <link rel="stylesheet" href="../../css/style.css">
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f7fa; }
        .admin-wrapper { display: flex; min-height: 100vh; }
        .sidebar { width: 240px; background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%); color: #fff; position: fixed; height: 100vh; }
        .sidebar-header { padding: 30px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-header img { width: 60px; margin-bottom: 10px; }
        .sidebar-header h2 { margin: 0; font-size: 18px; }
        .sidebar-nav { padding: 20px 0; }
        .nav-item { display: flex; align-items: center; padding: 15px 25px; color: rgba(255,255,255,0.7); text-decoration: none; transition: all 0.3s; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.1); color: #fff; border-left: 3px solid #c9a962; }
        .nav-item span:first-child { margin-right: 10px; font-size: 18px; }
        .main-content { flex: 1; margin-left: 240px; padding: 30px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .page-header h1 { margin: 0; font-size: 28px; color: #1a1a2e; }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #fff; padding: 24px; border-radius: 12px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-3px); }
        .stat-card h3 { margin: 0 0 10px; font-size: 14px; color: #888; font-weight: 500; }
        .stat-card .number { font-size: 32px; font-weight: bold; color: #1a1a2e; }
        
        /* æŒ‰é’® */
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #c9a962 0%, #a88b4c 100%); color: #fff; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(201,169,98,0.4); }
        .btn-danger { background: #ff4757; color: #fff; }
        .btn-success { background: #2ed573; color: #fff; }
        .btn-sm { padding: 6px 14px; font-size: 12px; }
        
        /* æœç´¢æ  */
        .filter-bar { background: #fff; padding: 20px; border-radius: 10px; margin-bottom: 20px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .filter-bar select, .filter-bar input { padding: 10px 15px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px; min-width: 140px; }
        .filter-bar input { flex: 1; min-width: 200px; }
        
        /* è¡¨æ ¼ */
        .table-wrapper { background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { background: #f8f9fa; padding: 15px; text-align: left; font-weight: 600; color: #555; font-size: 13px; text-transform: uppercase; }
        .data-table td { padding: 15px; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
        .data-table tr:hover { background: #fafafa; }
        
        /* çŠ¶æ€æ ‡ç­¾ */
        .status-tag { padding: 4px 10px; border-radius: 20px; font-size: 12px; }
        .status-tag.pending { background: #fff3e0; color: #ef6c00; }
        .status-tag.processed { background: #e8f5e9; color: #2e7d32; }
        
        /* æ“ä½œ */
        .action-btns { display: flex; gap: 8px; }
        .action-btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .view-btn { background: #e3f2fd; color: #1976d2; }
        .process-btn { background: #e8f5e9; color: #2e7d32; }
        
        /* æ‰¹é‡æ“ä½œ */
        .batch-actions { display: none; padding: 15px 20px; background: #fff3e0; border-radius: 8px; margin-bottom: 15px; align-items: center; gap: 15px; }
        .batch-actions.show { display: flex; }
        
        .pagination { display: flex; justify-content: center; gap: 8px; margin-top: 20px; }
        .page-btn { padding: 8px 14px; border: 1px solid #ddd; background: #fff; border-radius: 4px; cursor: pointer; }
        .page-btn.active { background: #c9a962; color: #fff; border-color: #c9a962; }
        
        /* å¼¹çª— */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-overlay.active { display: flex; }
        .modal { background: #fff; border-radius: 12px; width: 90%; max-width: 600px; max-height: 90vh; overflow: auto; }
        .modal-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { margin: 0; font-size: 18px; }
        .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #999; }
        .modal-body { padding: 20px; }
        .modal-footer { padding: 15px 20px; border-top: 1px solid #eee; text-align: right; }
        
        .detail-row { display: flex; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { width: 100px; color: #888; font-size: 13px; }
        .detail-value { flex: 1; color: #333; }
        
        .empty-state { text-align: center; padding: 60px; color: #999; }
    </style>
</head>
<body>
    <div class="admin-wrapper">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="../../images/logo.png" alt="å˜‰å­šå ‚">
                <h2>åå°ç®¡ç†</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="../dashboard.html" class="nav-item"><span>ğŸ“Š</span><span>æ§åˆ¶å°</span></a>
                <a href="collections.html" class="nav-item"><span>ğŸ¨</span><span>è—å“ç®¡ç†</span></a>
                <a href="news.html" class="nav-item"><span>ğŸ“°</span><span>æ–°é—»ç®¡ç†</span></a>
                <a href="submissions.html" class="nav-item active"><span>ğŸ“‹</span><span>æäº¤è®°å½•</span></a>
                <a href="#" onclick="logout()" class="nav-item"><span>ğŸšª</span><span>é€€å‡ºç™»å½•</span></a>
            </nav>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <h1>ğŸ“‹ æäº¤è®°å½•</h1>
                <button class="btn btn-primary" onclick="exportData()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
            </div>

            <!-- ç»Ÿè®¡ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>æ€»æäº¤æ•°</h3>
                    <div class="number" id="totalCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>ä»Šæ—¥æ–°å¢</h3>
                    <div class="number" id="todayCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>å¾…å¤„ç†</h3>
                    <div class="number" id="pendingCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>å·²å¤„ç†</h3>
                    <div class="number" id="processedCount">0</div>
                </div>
            </div>

            <!-- æ‰¹é‡æ“ä½œ -->
            <div class="batch-actions" id="batchActions">
                <span>å·²é€‰æ‹© <strong id="selectedCount">0</strong> é¡¹</span>
                <button class="btn btn-success btn-sm" onclick="batchProcess()">æ‰¹é‡æ ‡è®°å¤„ç†</button>
                <button class="btn btn-sm" onclick="clearSelection()">å–æ¶ˆ</button>
            </div>

            <!-- æœç´¢ -->
            <div class="filter-bar">
                <select id="filterCategory" onchange="renderTable()">
                    <option value="">å…¨éƒ¨åˆ†ç±»</option>
                    <option value="art">è‰ºæœ¯å“</option>
                    <option value="antique">å¤è‘£æ–‡ç‰©</option>
                    <option value="jewelry">ç å®å¥¢ä¾ˆå“</option>
                    <option value="coin">æ–‡çŒ®é‚®å¸</option>
                    <option value="nft">æ•°å­—è—å“</option>
                    <option value="misc">æ‚é¡¹</option>
                </select>
                <select id="filterStatus" onchange="renderTable()">
                    <option value="">å…¨éƒ¨çŠ¶æ€</option>
                    <option value="pending">å¾…å¤„ç†</option>
                    <option value="processed">å·²å¤„ç†</option>
                </select>
                <input type="text" id="searchKeyword" placeholder="ğŸ” æœç´¢è—å“åç§°/è”ç³»äºº..." oninput="renderTable()">
            </div>

            <!-- è¡¨æ ¼ -->
            <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width:40px;"><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                            <th>å›¾ç‰‡</th>
                            <th>ID</th>
                            <th>è—å“åç§°</th>
                            <th>å“ç±»</th>
                            <th>è”ç³»äºº</th>
                            <th>è”ç³»æ–¹å¼</th>
                            <th>çŠ¶æ€</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="submissionsTable">
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="pagination"></div>
        </main>
    </div>

    <!-- è¯¦æƒ…å¼¹çª— -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div class="modal-header">
                <h3>æäº¤è¯¦æƒ…</h3>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body" id="detailContent"></div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="markProcessedFromModal()">æ ‡è®°å·²å¤„ç†</button>
                <button class="btn" onclick="closeModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
    const STORAGE_KEY = 'jiafutang_submissions';
    let submissions = [];
    let currentPage = 1;
    const pageSize = 10;
    let selectedIds = [];
    let currentDetailId = null;

    // åˆå§‹åŒ–
    function init() { loadSubmissions(); }

    // åŠ è½½æ•°æ®
    function loadSubmissions() {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
            submissions = JSON.parse(stored);
        } else {
            submissions = [
                {id:1,itemName:'æ¸…ä»£ç“·å™¨èŠ±ç“¶',itemCategory:'antique',itemDesc:'æ¸…ä»£æ™šæœŸé’èŠ±ç“·',contactName:'å¼ ä¸‰',contactMobile:'13800138000',contactWechat:'zhangsan',city:'åŒ—äº¬',createdAt:'2026-02-17T10:30:00',handleStatus:'pending'},
                {id:2,itemName:'é½ç™½çŸ³ç”»ä½œ',itemCategory:'art',itemDesc:'åå®¶å­—ç”»',contactName:'æå››',contactMobile:'13900139000',city:'ä¸Šæµ·',createdAt:'2026-02-16T15:20:00',handleStatus:'processed'},
                {id:3,itemName:'ç¿¡ç¿ æ‰‹é•¯',itemCategory:'jewelry',itemDesc:'ç»ç’ƒç§ç¿¡ç¿ ',contactName:'ç‹äº”',contactWechat:'wangwu',city:'å¹¿å·',createdAt:'2026-02-15T09:00:00',handleStatus:'pending'}
            ];
            saveToStorage();
        }
        renderStats();
        renderTable();
    }

    // ä¿å­˜
    function saveToStorage() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(submissions));
    }

    // ç»Ÿè®¡
    function renderStats() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('totalCount').textContent = submissions.length;
        document.getElementById('todayCount').textContent = submissions.filter(s => s.createdAt.startsWith(today)).length;
        document.getElementById('pendingCount').textContent = submissions.filter(s => s.handleStatus !== 'processed').length;
        document.getElementById('processedCount').textContent = submissions.filter(s => s.handleStatus === 'processed').length;
    }

    // è¡¨æ ¼
    function renderTable() {
        const category = document.getElementById('filterCategory').value;
        const status = document.getElementById('filterStatus').value;
        const keyword = document.getElementById('searchKeyword').value.toLowerCase();
        
        let filtered = submissions.filter(s => {
            if (category && s.itemCategory !== category) return false;
            if (status && s.handleStatus !== status) return false;
            if (keyword && !(s.itemName||'').toLowerCase().includes(keyword) && !(s.contactName||'').toLowerCase().includes(keyword)) return false;
            return true;
        });
        
        filtered.sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt));
        
        const totalPages = Math.ceil(filtered.length / pageSize);
        const start = (currentPage - 1) * pageSize;
        const paged = filtered.slice(start, start + pageSize);
        
        const categoryMap = {art:'è‰ºæœ¯å“',antique:'å¤è‘£æ–‡ç‰©',jewelry:'ç å®å¥¢ä¾ˆå“',coin:'æ–‡çŒ®é‚®å¸',nft:'æ•°å­—è—å“',misc:'æ‚é¡¹'};
        
        const tbody = document.getElementById('submissionsTable');
        if (paged.length === 0) {
            tbody.innerHTML = '<tr><td colspan="9" class="empty-state">æš‚æ— æ•°æ®</td></tr>';
        } else {
            tbody.innerHTML = paged.map(s => {
                const isSelected = selectedIds.includes(s.id);
                const contact = s.contactMobile || s.contactWechat || '-';
                // å›¾ç‰‡æ˜¾ç¤º
                let imageHtml = '<span style="color:#999;">-</span>';
                if (s.itemImages && s.itemImages.length > 0) {
                    imageHtml = '<div style="display:flex;gap:4px;">' + 
                        s.itemImages.slice(0,2).map(img => '<img src="' + img + '" style="width:40px;height:40px;object-fit:cover;border-radius:4px;">').join('') +
                        (s.itemImages.length > 2 ? '<span style="font-size:11px;color:#888;line-height:40px;">+' + (s.itemImages.length-2) + '</span>' : '') +
                        '</div>';
                }
                return '<tr>' +
                    '<td><input type="checkbox" ' + (isSelected ? 'checked' : '') + ' onchange="toggleSelect(' + s.id + ')"></td>' +
                    '<td>' + imageHtml + '</td>' +
                    '<td>' + s.id + '</td>' +
                    '<td><strong>' + (s.itemName || '-') + '</strong></td>' +
                    '<td>' + (categoryMap[s.itemCategory] || '-') + '</td>' +
                    '<td>' + (s.contactName || '-') + '</td>' +
                    '<td>' + contact + '</td>' +
                    '<td><span class="status-tag ' + s.handleStatus + '">' + (s.handleStatus === 'processed' ? 'âœ“ å·²å¤„ç†' : 'â³ å¾…å¤„ç†') + '</span></td>' +
                    '<td><div class="action-btns">' +
                    '<button class="action-btn view-btn" onclick="viewDetail(' + s.id + ')">æŸ¥çœ‹</button>' +
                    '<button class="action-btn process-btn" onclick="markProcessed(' + s.id + ')">å¤„ç†</button></div></td>' +
                '</tr>';
            }).join('');
        }
        
        updateBatchActions();
        renderPagination(totalPages);
    }

    function renderPagination(totalPages) {
        if (totalPages <= 1) { document.getElementById('pagination').innerHTML = ''; return; }
        let html = '';
        for (let i = 1; i <= totalPages; i++) {
            html += '<button class="page-btn' + (i === currentPage ? ' active' : '') + '" onclick="goPage(' + i + ')">' + i + '</button>';
        }
        document.getElementById('pagination').innerHTML = html;
    }

    function goPage(page) { currentPage = page; renderTable(); }

    // å…¨é€‰
    function toggleSelectAll() {
        const checked = document.getElementById('selectAll').checked;
        const category = document.getElementById('filterCategory').value;
        const status = document.getElementById('filterStatus').value;
        const keyword = document.getElementById('searchKeyword').value.toLowerCase();
        
        let filtered = submissions.filter(s => {
            if (category && s.itemCategory !== category) return false;
            if (status && s.handleStatus !== status) return false;
            if (keyword && !(s.itemName||'').toLowerCase().includes(keyword) && !(s.contactName||'').toLowerCase().includes(keyword)) return false;
            return true;
        });
        
        selectedIds = checked ? filtered.map(s => s.id) : [];
        renderTable();
    }

    function toggleSelect(id) {
        if (selectedIds.includes(id)) selectedIds = selectedIds.filter(i => i !== id);
        else selectedIds.push(id);
        renderTable();
    }

    function updateBatchActions() {
        document.getElementById('batchActions').classList.toggle('show', selectedIds.length > 0);
        document.getElementById('selectedCount').textContent = selectedIds.length;
    }

    function clearSelection() { selectedIds = []; renderTable(); }

    // æ‰¹é‡å¤„ç†
    function batchProcess() {
        if (!confirm('ç¡®å®šè¦æ ‡è®°é€‰ä¸­çš„ ' + selectedIds.length + ' æ¡ä¸ºå·²å¤„ç†å—ï¼Ÿ')) return;
        selectedIds.forEach(id => {
            const s = submissions.find(x => x.id === id);
            if (s) s.handleStatus = 'processed';
        });
        saveToStorage();
        selectedIds = [];
        loadSubmissions();
        alert('æ‰¹é‡å¤„ç†æˆåŠŸï¼');
    }

    // è¯¦æƒ…
    function viewDetail(id) {
        currentDetailId = id;
        const s = submissions.find(x => x.id === id);
        if (!s) return;
        
        const categoryMap = {art:'è‰ºæœ¯å“',antique:'å¤è‘£æ–‡ç‰©',jewelry:'ç å®å¥¢ä¾ˆå“',coin:'æ–‡çŒ®é‚®å¸',nft:'æ•°å­—è—å“',misc:'æ‚é¡¹'};
        
        // å›¾ç‰‡æ˜¾ç¤º
        let imageHtml = '<p style="color:#999;">æ— </p>';
        if (s.itemImages && s.itemImages.length > 0) {
            imageHtml = '<div style="display:flex;gap:8px;flex-wrap:wrap;">' + 
                s.itemImages.map(img => '<img src="' + img + '" style="width:100px;height:100px;object-fit:cover;border-radius:6px;border:1px solid #eee;">').join('') +
                '</div>';
        }
        
        document.getElementById('detailContent').innerHTML = 
            '<div class="detail-row"><span class="detail-label">è—å“å›¾ç‰‡</span><span class="detail-value">' + imageHtml + '</span></div>' +
            '<div class="detail-row"><span class="detail-label">è—å“åç§°</span><span class="detail-value">' + (s.itemName || '-') + '</span></div>' +
            '<div class="detail-row"><span class="detail-label">å“ç±»</span><span class="detail-value">' + (categoryMap[s.itemCategory] || '-') + '</span></div>' +
            '<div class="detail-row"><span class="detail-label">è—å“æè¿°</span><span class="detail-value">' + (s.itemDesc || '-') + '</span></div>' +
            '<div class="detail-row"><span class="detail-label">è”ç³»äºº</span><span class="detail-value">' + (s.contactName || '-') + '</span></div>' +
            '<div class="detail-row"><span class="detail-label">æ‰‹æœºå·</span><span class="detail-value">' + (s.contactMobile || '-') + '</span></div>' +
            '<div class="detail-row"><span class="detail-label">å¾®ä¿¡å·</span><span class="detail-value">' + (s.contactWechat || '-') + '</span></div>' +
            '<div class="detail-row"><span class="detail-label">åŸå¸‚</span><span class="detail-value">' + (s.city || '-') + '</span></div>' +
            '<div class="detail-row"><span class="detail-label">æäº¤æ—¶é—´</span><span class="detail-value">' + formatDate(s.createdAt) + '</span></div>' +
            '<div class="detail-row"><span class="detail-label">çŠ¶æ€</span><span class="detail-value"><span class="status-tag ' + s.handleStatus + '">' + (s.handleStatus === 'processed' ? 'âœ“ å·²å¤„ç†' : 'â³ å¾…å¤„ç†') + '</span></span></div>';
        
        document.getElementById('detailModal').classList.add('active');
    }

    function closeModal() {
        document.getElementById('detailModal').classList.remove('active');
        currentDetailId = null;
    }

    function markProcessedFromModal() {
        if (currentDetailId) {
            markProcessed(currentDetailId);
            closeModal();
        }
    }

    function markProcessed(id) {
        const s = submissions.find(x => x.id === id);
        if (s) {
            s.handleStatus = 'processed';
            saveToStorage();
            loadSubmissions();
        }
    }

    function formatDate(dateStr) {
        if (!dateStr) return '-';
        const date = new Date(dateStr);
        return date.toLocaleDateString('zh-CN') + ' ' + date.toLocaleTimeString('zh-CN', {hour:'2-digit',minute:'2-digit'});
    }

    // å¯¼å‡º
    function exportData() {
        const categoryMap = {art:'è‰ºæœ¯å“',antique:'å¤è‘£æ–‡ç‰©',jewelry:'ç å®å¥¢ä¾ˆå“',coin:'æ–‡çŒ®é‚®å¸',nft:'æ•°å­—è—å“',misc:'æ‚é¡¹'};
        let csv = 'ID,è—å“åç§°,å“ç±»,è”ç³»äºº,æ‰‹æœºå·,å¾®ä¿¡,åŸå¸‚,æäº¤æ—¶é—´,å¤„ç†çŠ¶æ€\n';
        submissions.forEach(s => {
            csv += `${s.id},"${s.itemName || ''}",${categoryMap[s.itemCategory]||''},"${s.contactName || ''}","${s.contactMobile || ''}","${s.contactWechat || ''}","${s.city || ''}","${s.createdAt}","${s.handleStatus === 'processed' ? 'å·²å¤„ç†' : 'å¾…å¤„ç†'}"\n`;
        });
        const blob = new Blob(['\ufeff' + csv], {type:'text/csv;charset=utf-8'});
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `è—å“æäº¤è®°å½•_${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
    }

    function logout() { window.location.href = '../index.html'; }

    init();
    </script>
</body>
</html>
